<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        // button for reshowing all available tweets
        $body.append('<button id="show-all-tweets" class="hide"><p>Show all tweets</p></button>')

        // periodically check if last index in streams.home is the the most recent one we have
          // if not
            // add new tweets from streams.home
        var index = streams.home.length - 1;
        var lastIndex = -1;

        function sourceTweets() {
          index = streams.home.length - 1;
          while(index > lastIndex){
            var tweet = streams.home[index];
            var $tweet = $('<div class="tweet-card"></div>');
            var $tweetCardFooter = $('<div class="tweet-card-footer"></div>');
            $tweet.append($tweetCardFooter);
            $tweetCardFooter.append(`<p class="user"><a href="">@${tweet.user}</a></p><p class="timestamp">${tweet.created_at}</p>`);
            $tweet.prepend(`<p class="tweet">${tweet.message}</p>`);
            $tweet.appendTo($body);
            index -= 1;
          }
        }

        sourceTweets();
        setInterval(function() {
          sourceTweets();
        }, 10000);

        // user can click on a username to see only that user's tweets
        $('.user').on('click', function(e) {
          e.preventDefault();
          // get an array of all tweet nodes
          let allTweets = $('div.tweet-card').get();
          // filter to only nodes containing the usernames that were NOT clicked on
          let tweetsToHide = allTweets.filter((tweetCard) => {
            let user = tweetCard.querySelector('a').textContent;
            return user !== e.target.textContent;
            // console.log('user: ', user)
            // console.log('target: ', e.target.textContent)
          });
          // hide these tweets
          tweetsToHide.forEach((tweetCard) => {
            $(tweetCard).toggleClass('hide');
          });
          // show show-all-tweets button
          $('#show-all-tweets').toggleClass('hide');

        });

        $('#show-all-tweets').on('click', function() {
          $('#show-all-tweets').toggleClass('hide');
          $('.tweet-card').get().forEach((tweetCard) => {
            $(tweetCard).removeClass('hide');
          })
        })
      });

    </script>
  </body>
</html>
